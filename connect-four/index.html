<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Connect Four</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <main id="app" style="height: 100vh; overflow: hidden">
      <div
        style="
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <div
          class="m-auto"
          style="background: #0067d0; border-radius: 10px; padding: 10px"
        >
          <table class="m-auto">
            <tr v-for="(row, y) of [0, 1, 2, 3, 4, 5]">
              <td
                v-for="(column, x) of board"
                :style="{
                  cursor: column.length < 6 && !animationInProgress ? 'pointer' : 'unset',
                  height: squareWidth + 'px',
                  width: squareWidth + 'px',
                  background: '#0067d0',
                }"
                @click="spaceClicked(x)"
              >
                <svg :width="squareWidth" :height="squareWidth">
                  <circle
                    :r="squareWidth/2 * 0.85"
                    :cx="squareWidth/2"
                    :cy="squareWidth/2"
                    :fill="animationInProgress && selectedColumn === x && currentRow === y ? 'red' :
                      column[5 - y] || '#212529'"
                  ></circle>
                </svg>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </main>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
  </body>
</html>

<script type="module">
  import { createApp } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";

  createApp({
    data() {
      return {
        board: [[], [], [], [], [], [], []],
        moveSpot: null,
        width: 800,
        animationDuration: 150,
        animationInProgress: false,
        squareWidth: 20,
        selectedColumn: null,
        currentRow: null,
      };
    },
    mounted() {
      this.width =
        Math.min(window.innerWidth, window.innerHeight) -
        (window.innerWidth > window.innerHeight ? 32 : 34);
      this.squareWidth =
        window.innerWidth > window.innerHeight
          ? this.width / 6
          : this.width / 7;
    },
    computed: {},
    methods: {
      spaceClicked(x) {
        if (this.board[x].length === 6 || this.animationInProgress) return;
        this.selectedColumn = x;
        this.animationInProgress = true;
        this.currentRow = 0;
        for (let i = 1; i < 6 - this.board[x].length; i++) {
          setTimeout(() => {
            this.currentRow = i;
          }, this.animationDuration * i);
        }
        setTimeout(() => {
          this.selectedColumn = null;
          this.currentRow = null;
          this.board[x].push("red");
          this.animationInProgress = false;
        }, this.animationDuration * 5 - this.board[x].length);
      },
      getOptions(color, board) {
        const options = [];

        return options;
      },
      getScore(board, moves, color, depth) {
        // todo
        return Math.random();
      },
    },
  }).mount("#app");
</script>
